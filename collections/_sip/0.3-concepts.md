---
title: "SIP: Concepts"
permalink: /sip/concepts/
excerpt: "Notes and resources about VoIP communications and protocols"
header:
  image: "/assets/images/academy/sip.svg"
last_modified_at: 2023-03-23 21:00:00 +00:00
toc: true
---

## SIP Concepts

**Transaction** - A transaction consists of a Request, any non-final (Provisional) `1XX` Responses received, and a final Response, as well as the acknowledgments of the Responses (ACK or PRACK), except for ACKs to `2XX` Responses.
* The stateful mode enables routing features, such as serial/parallel forking, load balancing, and hunt groups.
* If the UA creates multiple outgoing branches the difference will consist in the `branch` parameter in the topmost `Via` header.

**Dialog** - Dialog is a peer-to-peer SIP relationship between two UAs that persists for some time. 
* Is composed of a group of Transactions: one to create, another to end, with optional transactions in between to update/refresh the dialog.
* A dialog is identified at each UA with a dialog ID, which consists of a `Call-ID` value, a local `FROM` tag from the caller and a remote `TO` tag from the callee.

Dialogs are created through the generation of non-failure responses to requests with specific methods. 
* RTC dialog: Initiated by the INVITE request, active and terminated by the BYE request. Only `2XX` and `101-199` responses with a `To` `tag`, to the request, will establish a dialog.
* PRESENCE dialog: Initiated by the SUBSCRIBE request, activated by an Expires header `>`0`, and terminated by the expiration timeout or an update to Expires header `=0`.

A dialog has the following states:
* Early - A dialog established by a provisional response to a request is in the "early" state and it is called an early dialog.
* Estabished - A dialog established by a 200 OK acknowledged.
* Canceled - When a CANCEL request is sent by the caller, before a final response.
* Terminated - The dialog was terminated.

The request that is part of an active dialog has a `tag` in the `To` header (unlike the initial request) and is called a Mid Dialog Request.

> The `From` and `To` headers are set from the prespective of the sender of the request, so the value of the `From` `tag` from the initial invite can be found in the `To` `tag` of the Mid Dialog Request, if sent by the callee.

Example 1

![sip_transactions1](http://www.plantuml.com/plantuml/proxy?cache=no&fmt=svg&src=https://raw.githubusercontent.com/bandonga/bandonga.github.io/master/assets/puml/sip_transactions1.puml)

Here, (1) to (3) are one transaction. (4) is the second transaction and (5) and (6) constitute the third transaction. Together, these three transactions constitute one **dialog**.

Example 2

![sip_transactions1](http://www.plantuml.com/plantuml/proxy?cache=no&fmt=svg&src=https://raw.githubusercontent.com/bandonga/bandonga.github.io/master/assets/puml/sip_transactions2.puml)

In this example, the messages from (1) to (4) constitute one transaction. This is a "no-dialog" scenario.

**Session** - A session is just a media stream (e.g. audio or video) flowing between peers, usually consisting of RTP packets.

![sip_proxy](http://www.plantuml.com/plantuml/proxy?cache=no&fmt=svg&src=https://raw.githubusercontent.com/bandonga/bandonga.github.io/master/assets/puml/sip_proxy.puml)
